var t=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{s(r.next(t))}catch(t){a(t)}}function c(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((r=r.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=c(0),o.throw=c(1),o.return=c(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeChunksFromHTML=u,exports.translate=h,exports.translateAutoHotkeyStyle=p;var n=require("cheerio"),r=require("@libs/fetch"),i=require("urlencode"),a=require("@libs/defaultCover"),o=require("@libs/novelStatus"),c=function(){function c(){this.id="69xinshu",this.name="69‰π¶Âêß",this.icon="src/cn/69xinshu/icon.png",this.site="https://69shuba.com/",this.version="1.1.2"}return c.prototype.popularNovels=function(i){return t(this,void 0,void 0,(function(){var t,o,c,s,u,l,h;return e(this,(function(f){switch(f.label){case 0:if(i>1)return[2,[]];t=[this.site+"novels/female",this.site+"novels/male"],o=[],c=new Set,s=function(t){var i,s,u;return e(this,(function(e){switch(e.label){case 0:return[4,(0,r.fetchApi)(t)];case 1:return(i=e.sent()).ok?(u=n.load,[4,i.text()]):[2,"continue"];case 2:return(s=u.apply(void 0,[e.sent()]))("div.mybox").each((function(t,e){s(e).find("ul > li > div > div.newbox > ul#article_list_content > li").each((function(t,e){var n,r=s(e),i=r.find("a").first(),u=null===(n=i.attr("href"))||void 0===n?void 0:n.trim(),l=i.find("img").attr("src")||i.find("img").attr("data-src")||a.defaultCover,h=r.find("div.newnav > h3").text().trim();u&&h&&!c.has(u)&&(o.push({name:h,path:u,cover:l}),c.add(u))}))})),[2]}}))},u=0,l=t,f.label=1;case 1:return u<l.length?(h=l[u],[5,s(h)]):[3,4];case 2:f.sent(),f.label=3;case 3:return u++,[3,1];case 4:return[2,o]}}))}))},c.prototype.parseNovel=function(i){return t(this,void 0,void 0,(function(){var t,c,u,l,f,p,d,v,b,m,g,w,y,x,k,T,C,S,L,E,j,A;return e(this,(function(e){switch(e.label){case 0:if(!(t=s(i,this.site)))throw new Error("Invalid novel URL");return[4,(0,r.fetchApi)(t)];case 1:if(!(c=e.sent()).ok)throw new Error("Failed to fetch novel");return l=n.load,[4,c.text()];case 2:switch(u=l.apply(void 0,[e.sent()]),f=u("div.container ul li.col-8 div.mybox div.bookbox").first(),p=f.find("div.bookimg2 img").attr("src")||a.defaultCover,d=f.find("div.booknav2 h1").contents().map((function(t,e){return u(e).text()})).get().join("").trim(),v=d,b=f.find("div.booknav2 p:nth-of-type(1) a").text().trim()||void 0,m=f.find("div.booknav2 p:nth-of-type(2) a").text().trim(),g=m||""){case"Ë®ÄÊÉÖÂ∞èËØ¥":g="Romance";break;case"ÁéÑÂπªÈ≠îÊ≥ï":g="Fantasy";break;case"‰øÆÁúüÊ≠¶‰æ†":g="Martial Arts";break;case"Á©øË∂äÊó∂Á©∫":g="Time Travel";break;case"ÈÉΩÂ∏ÇÂ∞èËØ¥":g="Urban";break;case"ÂéÜÂè≤ÂÜõ‰∫ã":g="Historical";break;case"Ê∏∏ÊàèÁ´ûÊäÄ":g="Games";break;case"ÁßëÂπªÁ©∫Èó¥":g="Sci-Fi";break;case"ÊÇ¨ÁñëÊÉäÊÇö":g="Mystery";break;case"Âêå‰∫∫Â∞èËØ¥":g="Fan Fiction";break;case"ÂÆòÂú∫ËÅåÂú∫":g="Work Life";break;case"ÈùíÊò•Ê†°Âõ≠":g="School Life"}return w=f.find("div.booknav2 p:nth-of-type(3)").text().trim(),y="",y=w.includes("ËøûËΩΩ")?o.NovelStatus.Ongoing:w.includes("ÂÖ®Êú¨")?o.NovelStatus.Completed:o.NovelStatus.Unknown,(k=f.find("div.booknav2 p").not(":nth-of-type(-n+3)").first()).length?(x=k.text().trim())?[4,h(x,"ru")]:[3,4]:[3,4];case 3:x=(x=e.sent()).replace(/<[^>]+>/g,""),e.label=4;case 4:if(T=null===(A=u("div.container div.mybox a[href]").attr("href"))||void 0===A?void 0:A.trim(),C=[],!T)return[3,7];if(!(S=s(T,this.site)))throw new Error("Invalid chapter list URL");return[4,(0,r.fetchApi)(S)];case 5:return(L=e.sent()).ok?(j=n.load,[4,L.text()]):[3,7];case 6:(E=j.apply(void 0,[e.sent()]))("div.container div.mybox div.catalog ul li a").each((function(t,e){var n,r=u(E(e)),i=(null!==(n=r.attr("href"))&&void 0!==n?n:"").trim(),a=r.text().trim();i&&a&&C.push({name:a,path:i,releaseTime:void 0})})),e.label=7;case 7:return[2,{path:i,name:v,cover:p,summary:x,author:b,genres:g,status:y,chapters:C}]}}))}))},c.prototype.parseChapter=function(i){return t(this,void 0,void 0,(function(){var t,a,o,c,u,l,h,p,d,v,b;return e(this,(function(e){switch(e.label){case 0:if(!(t=s(i,this.site)))throw new Error("Invalid chapter URL");return[4,(0,r.fetchApi)(t)];case 1:if(!(a=e.sent()).ok)throw new Error("Failed to fetch chapter");return c=n.load,[4,a.text()];case 2:return o=c.apply(void 0,[e.sent()]),(u=o("div.container div.mybox")).length?(l=u.find("div.txtnav h1").text().trim(),(h=u.find("div.txtnav")).find("h1, div:first-child, div:nth-child(2), div.bottom-ad").remove(),p="",(d=h.children("div").first()).length&&(p=d.html()||""),p=p.replace(/<!--[\s\S]*?-->/g,"").trim(),(v=p)?(b="",(v="<h1>"+l+"</h1>üêº<br>"+v).trim()?[4,f(v,"ru")]:[3,4]):[2,"Error: Chapter content was empty"]):[2,"Error: Could not find chapter container"];case 3:return b=e.sent(),[3,5];case 4:b="",e.label=5;case 5:return[2,b.trim()]}}))}))},c.prototype.searchNovels=function(o,c){return t(this,void 0,void 0,(function(){var t,u,l,h,f,p=this;return e(this,(function(e){switch(e.label){case 0:return c>1?[2,[]]:(t="".concat(this.site,"/modules/article/search.php"),[4,(0,r.fetchApi)(t,{method:"POST",body:"searchkey=".concat((0,i.encode)(o,"gbk"),"&submit=Search"),headers:{"content-type":"application/x-www-form-urlencoded"}})]);case 1:if(403===(u=e.sent()).status)throw new Error("Captcha detected (HTTP 403), please open in webview.");return[4,u.text()];case 2:return l=e.sent(),h=(0,n.load)(l),f=[],h("div.container div.mybox ul li").each((function(t,e){h(e).find("div.newbox > ul > li").each((function(t,e){var n,r=h(e),i=null===(n=r.find("a").attr("href"))||void 0===n?void 0:n.trim(),o=r.find("img").attr("src")||r.find("img").attr("data-src")||a.defaultCover,c=r.find("div.newnav h3").contents().map((function(t,e){return h(e).text()})).get().join("").trim();i&&c&&f.push({name:c,path:i,cover:s(o,p.site)||a.defaultCover})}))})),[2,f]}}))}))},c}();exports.default=new c;var s=function(t,e){if(t)try{return t.startsWith("//")?new URL(e).protocol+t:t.startsWith("http://")||t.startsWith("https://")?t:new URL(t,e).href}catch(t){return}};function u(t,e){return void 0===e&&(e=1e3),function(t){return t.replace(/<\/p\s*>/gi,"\n").replace(/<p[^>]*>/gi,"\n").replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]+>/g,"").replace(/\u3000/g," ").replace(/&nbsp;/g," ").trim().split(/\n+/).map((function(t){return t.trim()})).filter(Boolean)}(t).flatMap((function(t){return function(t,e){return void 0===e&&(e=1e3),t.length<=e?[t]:t.split(/([„ÄÇ.!?ÔºÅÔºü])/g).reduce((function(t,n){return!t.length||(t[t.length-1]+n).length>e?t.push(n):t[t.length-1]+=n,t}),[]).flatMap((function(t){if(t.length<=e)return[t];for(var n=[],r="",i=0,a=t.split(/\s+/);i<a.length;i++){var o=a[i];(r+" "+o).trim().length>e?(r&&n.push(r.trim()),r=o):r=(r+" "+o).trim()}return r&&n.push(r.trim()),n}))}(t,e)}))}function l(n,r){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return[4,fetch("https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-CN&tl=".concat(r,"&dt=t&q=").concat(encodeURIComponent(n)))];case 1:if(!(t=e.sent()).ok)throw new Error("Translate failed ".concat(t.status," ").concat(n));return[4,t.json()];case 2:return[2,e.sent()[0].map((function(t){return t[0]})).join("")]}}))}))}function h(n,r){return t(this,void 0,void 0,(function(){var t,i,a,o,c,s,h;return e(this,(function(e){switch(e.label){case 0:if(n.length<2)return[2,n];t=u(n,1e3),i=[],a=0,o=t,e.label=1;case 1:return a<o.length?(c=o[a],h=(s=i).push,[4,l(c,r)]):[3,5];case 2:return h.apply(s,[e.sent()]),[4,new Promise((function(t){return setTimeout(t,500)}))];case 3:e.sent(),e.label=4;case 4:return a++,[3,1];case 5:return[2,i.map((function(t){return"<p>".concat(t,"</p>")})).join("\n")]}}))}))}function f(n,r){return t(this,void 0,void 0,(function(){var t,i,a,o,c,s,u,l,h,f,d,v;return e(this,(function(e){switch(e.label){case 0:for(n=n.replace(/<(\w+)[^>]*>/g,"<$1>"),t=[],i=new RegExp("(".concat(["</p>","</h1>","</h2>","</h3>","</h4>","</li>","<br>"].join("|"),")"),"gi"),a=n.split(i).filter(Boolean),f=0;f<a.length;f+=2)o=(a[f]||"").replace(/<[^>]+>/g,"").trim(),c=(a[f+1]||"").toLowerCase(),(o||c)&&("</li>"===c?o&&t.push({tag:"LI",text:o,parentTag:"UL"}):c.startsWith("</h")?(o&&t.push({tag:c.replace(/[<>]/g,"").toUpperCase(),text:o}),t.push({tag:"BR",text:""})):o&&t.push({tag:"P",text:o}));return s=" üòÄ ",[4,p(t.map((function(t){return"BR"===t.tag?"":t.text})).join(s),r)];case 1:for(u=(u=e.sent()).replace(/^\[\[\"/,"").replace(/\"\],\s*\[\".*\"\]\]$/,""),l=u.split(s),h="",f=0;f<t.length;f++)d=t[f],v=l[f]||"",/^–ì–ª–∞–≤–∞\s+\d+/i.test(v)?h+="<h1>".concat(v,"</h1>"):"BR"===d.tag?h+="<br>":"LI"===d.tag?h+="<ul><li>".concat(v,"</li></ul>"):d.tag.startsWith("H")?h+="<".concat(d.tag,">").concat(v,"</").concat(d.tag,">"):h+="<p>".concat(v,"</p>");return[2,h]}}))}))}function p(n,r){return t(this,void 0,void 0,(function(){var t,i,a,o,c,s;return e(this,(function(e){switch(e.label){case 0:t="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36",i=JSON.stringify([[[n],"auto",r],"wt_lib"]),a="",e.label=1;case 1:return e.trys.push([1,6,,7]),[4,fetch("https://translate-pa.googleapis.com/v1/translateHtml",{method:"POST",headers:{"User-Agent":t,"X-Goog-API-Key":"AIzaSyATBXajvzQLTDHEQbcpq0Ihe0vWDHmO520","Content-Type":"application/json+protobuf"},body:i})];case 2:return(o=e.sent()).ok?[3,4]:(a="HTTP error ".concat(o.status,": ").concat(o.statusText),[4,o.text()]);case 3:return c=e.sent(),[2,a+="\nError body:"+c];case 4:return[4,o.text()];case 5:return a=e.sent(),[3,7];case 6:return s=e.sent(),a="Fetch failed:"+s,[3,7];case 7:return[2,a]}}))}))}
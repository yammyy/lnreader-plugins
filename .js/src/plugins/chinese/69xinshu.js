var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,a){function i(t){try{c(n.next(t))}catch(t){a(t)}}function s(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,s)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeChunksFromHTML=c,exports.translate=function(r,n){return t(this,void 0,void 0,(function(){var t,o,a,i,s,u,h;return e(this,(function(e){switch(e.label){case 0:if(r.length<2)return[2,r];t=c(r,1e3),o=[],a=0,i=t,e.label=1;case 1:return a<i.length?(s=i[a],h=(u=o).push,[4,l(s,n)]):[3,5];case 2:return h.apply(u,[e.sent()]),[4,new Promise((function(t){return setTimeout(t,500)}))];case 3:e.sent(),e.label=4;case 4:return a++,[3,1];case 5:return[2,o.map((function(t){return"<p>".concat(t,"</p>")})).join("\n")]}}))}))},exports.translateAutoHotkeyStyle=h;var r=require("cheerio"),n=require("@libs/fetch"),o=require("@libs/defaultCover"),a=require("@libs/novelStatus");var i=function(){function i(){this.id="69xinshu",this.name="69‰π¶Âêß",this.icon="src/cn/69xinshu/icon.png",this.site="https://www.69yue.top/",this.version="36.1.2"}return i.prototype.popularNovels=function(r){return t(this,void 0,void 0,(function(){var t,a,i,c,l=this;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site,"api/list/0/0/1/").concat(r,".json"),[4,(0,n.fetchApi)(t)];case 1:return(a=e.sent()).ok?[4,a.json()]:[2,[]];case 2:if(200!==(i=e.sent()).code||!Array.isArray(i.data))throw new Error("Invalid API response");return c=i.data.map((function(t){var e,r,n,a,i,c;return{name:t.title.trim(),path:s(t.infourl.trim(),l.site)||"",cover:(null===(e=t.coverUrl)||void 0===e?void 0:e.trim())?t.coverUrl.startsWith("/")?l.site+t.coverUrl.replace(/^\//,""):t.coverUrl:o.defaultCover,author:(null===(r=t.author)||void 0===r?void 0:r.trim())||"",description:(null===(n=t.description)||void 0===n?void 0:n.trim())||"",status:(null===(a=t.status)||void 0===a?void 0:a.trim())||"",category:(null===(i=t.categoryName)||void 0===i?void 0:i.trim())||"",lastUpdate:(null===(c=t.lastUpdated)||void 0===c?void 0:c.trim())||""}})),[2,c]}}))}))},i.prototype.parseNovel=function(n){return t(this,void 0,void 0,(function(){var t,i,c,l,u,h,p,f,d,v,m,g,b,w,y,k,x,U,T,C,R,A,j,I,L,E=this;return e(this,(function(e){switch(e.label){case 0:t=s(n,this.site)||"",i="https://api.allorigins.win/get?url="+encodeURIComponent(t),console.log(i),c="",e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(i)];case 2:if(!(l=e.sent()).ok)throw new Error("HTTP error! status: ".concat(l.status));return[4,l.text()];case 3:return c=e.sent(),console.log(c),[3,5];case 4:return u=e.sent(),console.error("Error fetching URL:"+i,u),[3,5];case 5:switch(h=(0,r.load)(c),p=s(null===(j=h("img.object-cover").attr("src"))||void 0===j?void 0:j.trim(),this.site)||o.defaultCover,f=h("h1").text().trim()||"No title",d=(d=h("div > p.text-base").first().find("a").text().trim())||""){case"ÁéÑÂπªÈ≠îÊ≥ï":d="Fantasy";break;case"‰øÆÁúüÊ≠¶‰æ†":d="Martial Arts";break;case"Ë®ÄÊÉÖÂ∞èËØ¥":d="Romance";break;case"ÂéÜÂè≤ÂÜõ‰∫ã":d="Historical";break;case"Ê∏∏ÊàèÁ´ûÊäÄ":d="Games";break;case"ÁßëÂπªÁ©∫Èó¥":d="Sci-Fi";break;case"ÊÇ¨ÁñëÊÉäÊÇö":d="Mystery";break;case"Âêå‰∫∫Â∞èËØ¥":d="Fan Fiction";break;case"ÈÉΩÂ∏ÇÂ∞èËØ¥":d="Urban";break;case"ÂÆòÂú∫ËÅåÂú∫":d="Work Life";break;case"Á©øË∂äÊó∂Á©∫":d="Time Travel";break;case"ÈùíÊò•Ê†°Âõ≠":d="School Life";break;case"ÂÖ∂‰ªñ":d="Other"}if(v=h("div > p").eq(2).text().trim(),console.log(v),m="",m=v.includes("ËøûËΩΩ‰∏≠")?a.NovelStatus.Ongoing:v.includes("ÂÆåÊú¨")?a.NovelStatus.Completed:a.NovelStatus.Unknown,g="",b="",w=0,"No title"!==f)return[3,6];throw new Error("Failed to parse novel details");case 6:return y="".concat(this.site,"api/search"),[4,fetch(y,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Referer:"".concat(this.site,"search.html?q=").concat(encodeURIComponent(f))},body:"q=".concat(encodeURIComponent(f))})];case 7:return(R=e.sent()).ok?[4,R.json()]:[3,9];case 8:200===(k=e.sent()).code&&Array.isArray(k.results)&&(x=k.results[0],b=(null===(I=x.author)||void 0===I?void 0:I.trim())||"",g=(null===(L=x.description)||void 0===L?void 0:L.trim())||"",w=x.score?parseFloat(x.score):0),e.label=9;case 9:if(U=(n.replace(/\/$/,"").split("/").pop()||"").split(".")[0],T=U?"https://www.69yue.top/api/articleitems/"+U+".json":void 0,console.log("Chapter List URL:",T),C=[],T)return[3,10];throw new Error("Could not determine chapter list URL");case 10:return[4,fetch(T,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Referer:t}})];case 11:return(R=e.sent()).ok?[4,R.json()]:[3,13];case 12:200===(A=e.sent()).code&&Array.isArray(A.items)&&(C=A.items.map((function(t){var e;return{name:(null===(e=t.cn)||void 0===e?void 0:e.trim())||"Unknown",path:t.cid?E.site+"article/"+t.cid+".html":""}}))),e.label=13;case 13:return[2,{path:n,name:f,cover:p,summary:g||"No description",author:b,genres:d,status:m,rating:w/2,chapters:C}]}}))}))},i.prototype.parseChapter=function(o){return t(this,void 0,void 0,(function(){var t,a,i,s,c,l,h,p;return e(this,(function(e){switch(e.label){case 0:if(!(t=o))throw new Error("Invalid chapter URL");return[4,(0,n.fetchApi)(t)];case 1:if(!(a=e.sent()).ok)throw new Error("Failed to fetch chapter");return s=r.load,[4,a.text()];case 2:return i=s.apply(void 0,[e.sent()]),c=i("main > header > h2").first().text().trim(),(l=i("main > article > article").first()).length?(l.find("div").remove(),(h=l.html()||"")?(p="",(h="<h1>"+c+"</h1>üêº<br>"+h).trim()?[4,u(h,"ru")]:[3,4]):[2,"Error: Chapter content was empty"]):[2,"Error: Could not find chapter content"];case 3:return p=e.sent(),[3,5];case 4:p="",e.label=5;case 5:return[2,p.trim()]}}))}))},i.prototype.searchNovels=function(r,n){return t(this,void 0,void 0,(function(){var t,n,a,i,c=this;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site,"api/search"),[4,fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Referer:"".concat(this.site,"search.html?q=").concat(encodeURIComponent(r))},body:"q=".concat(encodeURIComponent(r))})];case 1:return(n=e.sent()).ok?[4,n.json()]:[2,[]];case 2:return 200===(a=e.sent()).code&&Array.isArray(a.results)?(i=a.results.map((function(t){var e;return{name:(null===(e=t.title)||void 0===e?void 0:e.trim())||"Unknown",path:s(t.infourl.trim(),c.site)||"",cover:o.defaultCover}})),[2,i]):[2,[]]}}))}))},i}();exports.default=new i;var s=function(t,e){if(t)try{if(t.startsWith("//"))return new URL(e).protocol+t;if(t.startsWith("http://")||t.startsWith("https://"))return t;var r=e.endsWith("/")?e.slice(0,-1):e,n=t.startsWith("/")?t.slice(1):t;return new URL(n,r).href}catch(t){return}};function c(t,e){return void 0===e&&(e=1e3),function(t){return t.replace(/<\/p\s*>/gi,"\n").replace(/<p[^>]*>/gi,"\n").replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]+>/g,"").replace(/\u3000/g," ").replace(/&nbsp;/g," ").trim().split(/\n+/).map((function(t){return t.trim()})).filter(Boolean)}(t).flatMap((function(t){return function(t,e){return void 0===e&&(e=1e3),t.length<=e?[t]:t.split(/([„ÄÇ.!?ÔºÅÔºü])/g).reduce((function(t,r){return!t.length||(t[t.length-1]+r).length>e?t.push(r):t[t.length-1]+=r,t}),[]).flatMap((function(t){if(t.length<=e)return[t];for(var r=[],n="",o=0,a=t.split(/\s+/);o<a.length;o++){var i=a[o];(n+" "+i).trim().length>e?(n&&r.push(n.trim()),n=i):n=(n+" "+i).trim()}return n&&r.push(n.trim()),r}))}(t,e)}))}function l(r,n){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return[4,fetch("https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-CN&tl=".concat(n,"&dt=t&q=").concat(encodeURIComponent(r)))];case 1:if(!(t=e.sent()).ok)throw new Error("Translate failed ".concat(t.status," ").concat(r));return[4,t.json()];case 2:return[2,e.sent()[0].map((function(t){return t[0]})).join("")]}}))}))}function u(r,n){return t(this,void 0,void 0,(function(){var t,o,a,i,s,c,l,u,p,f,d,v;return e(this,(function(e){switch(e.label){case 0:for(r=r.replace(/<(\w+)[^>]*>/g,"<$1>"),t=[],o=new RegExp("(".concat(["</p>","</h1>","</h2>","</h3>","</h4>","</li>","<br>"].join("|"),")"),"gi"),a=r.split(o).filter(Boolean),f=0;f<a.length;f+=2)i=(a[f]||"").replace(/<[^>]+>/g,"").trim(),s=(a[f+1]||"").toLowerCase(),(i||s)&&("</li>"===s?i&&t.push({tag:"LI",text:i,parentTag:"UL"}):s.startsWith("</h")?(i&&t.push({tag:s.replace(/[<>]/g,"").toUpperCase(),text:i}),t.push({tag:"BR",text:""})):i&&t.push({tag:"P",text:i}));return c=" üòÄ ",[4,h(t.map((function(t){return"BR"===t.tag?"":t.text})).join(c),n)];case 1:for(l=(l=e.sent()).replace(/^\[\[\"/,"").replace(/\"\],\s*\[\".*\"\]\]$/,""),u=l.split(c),p="",f=0;f<t.length;f++)d=t[f],v=u[f]||"",/^–ì–ª–∞–≤–∞\s+\d+/i.test(v)?p+="<h1>".concat(v,"</h1>"):"BR"===d.tag?p+="<br>":"LI"===d.tag?p+="<ul><li>".concat(v,"</li></ul>"):d.tag.startsWith("H")?p+="<".concat(d.tag,">").concat(v,"</").concat(d.tag,">"):p+="<p>".concat(v,"</p>");return[2,p]}}))}))}function h(r,n){return t(this,void 0,void 0,(function(){var t,o,a,i,s,c;return e(this,(function(e){switch(e.label){case 0:t="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36",o=JSON.stringify([[[r],"auto",n],"wt_lib"]),a="",e.label=1;case 1:return e.trys.push([1,6,,7]),[4,fetch("https://translate-pa.googleapis.com/v1/translateHtml",{method:"POST",headers:{"User-Agent":t,"X-Goog-API-Key":"AIzaSyATBXajvzQLTDHEQbcpq0Ihe0vWDHmO520","Content-Type":"application/json+protobuf"},body:o})];case 2:return(i=e.sent()).ok?[3,4]:(a="HTTP error ".concat(i.status,": ").concat(i.statusText),[4,i.text()]);case 3:return s=e.sent(),[2,a+="\nError body:"+s];case 4:return[4,i.text()];case 5:return a=e.sent(),[3,7];case 6:return c=e.sent(),a="Fetch failed:"+c,[3,7];case 7:return[2,a]}}))}))}
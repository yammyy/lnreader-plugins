var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeChunksFromHTML=c,exports.translate=u,exports.translateAutoHotkeyStyle=p;var r=require("cheerio"),n=require("@libs/fetch"),a=require("@libs/defaultCover"),i=require("@libs/novelStatus"),o=function(){function o(){this.id="ixdzs8",this.name="Áà±‰∏ãÁîµÂ≠ê‰π¶",this.site="https://ixdzs8.com/",this.version="7.0.3",this.icon="src/cn/ixdzs8/favicon.png",this.imageRequestInit={headers:{Referer:this.site}}}return o.prototype.popularNovels=function(i){return t(this,void 0,void 0,(function(){var t,o,c,l,u,h,p=this;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site,"hot/?page=").concat(i),[4,(0,n.fetchApi)(t)];case 1:return(o=e.sent()).ok?(l=r.load,[4,o.text()]):[2,[]];case 2:return c=l.apply(void 0,[e.sent()]),u=[],h=new Set,c("ul.u-list > li.burl").each((function(t,e){var r,n,i,o,l,f=c(e),d=f.find(".l-info h3 a");i=null===(r=d.attr("href"))||void 0===r?void 0:r.trim(),o=(d.attr("title")||d.text()||"").trim(),l=null===(n=f.find(".l-img img").attr("src"))||void 0===n?void 0:n.trim(),i&&o&&(u.push({name:o,path:i,cover:s(l,p.site)||a.defaultCover}),h.add(i))})),[2,u]}}))}))},o.prototype.parseNovel=function(o){return t(this,void 0,void 0,(function(){var t,c,l,h,p,f,d,v,m,g,b,w,y,x,k,C,T,E;return e(this,(function(e){switch(e.label){case 0:if(!(t=s(o,this.site)))throw new Error("Invalid novel URL");return[4,(0,n.fetchApi)(t)];case 1:if(!(c=e.sent()).ok)throw new Error("Failed to fetch novel");return h=r.load,[4,c.text()];case 2:return l=h.apply(void 0,[e.sent()]),p=l("div.novel"),(f=l("p#intro.pintro")).find("span.icon").remove(),void 0===(d=null===(E=f.html())||void 0===E?void 0:E.replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]+>/g,"").replace(/\u3000/g," ").replace(/&nbsp;/g," ").split("\n").map((function(t){return t.trim()})).filter((function(t){return t.length>0})).join(" "))?[3,4]:[4,u(d,"ru")];case 3:return v=e.sent(),[3,5];case 4:v=void 0,e.label=5;case 5:switch(m=p.find(".n-text p a.nsort").text().trim()){case"ÁéÑÂπªÂ•áÂπª":m="Fantasy";break;case"Ê≠¶‰æ†Â∞èËØ¥":m="Martial Arts";break;case"‰øÆÁúü‰ªô‰æ†":m="Cultivation";break;case"ÈÉΩÂ∏ÇÈùíÊò•":m="Urban";break;case"ÂÜõ‰∫ãÂéÜÂè≤":m="Historical";break;case"ÁΩëÊ∏∏Á´ûÊäÄ":m="Games";break;case"ÁßëÂπªÁÅµÂºÇ":m="Sci-fi";break;case"Ë®ÄÊÉÖÁ©øË∂ä":m="Romance";break;case"ËÄΩÁæéÂêå‰∫∫":m="Yaoi";break;case"ÂÖ∂‰ªñÂ∞èËØ¥":m="Other"}return g=l("div.panel div.tags"),b=g.find("em a").map((function(t,e){return l(e).text().trim()})).get().filter((function(t){return t.length>0})).join(", "),b=m+", "+b,w=p.find(".n-text p span.lz").text().trim(),y=p.find(".n-text p span.end").text().trim(),x="Unknown",x=y.length>0?"Completed":w.length>0?"Ongoing":"Unknown",k={path:o,name:p.find(".n-text h1").text().trim()||"Untitled",cover:s(p.find(".n-img img").attr("src"),this.site)||a.defaultCover,summary:v,author:p.find(".n-text p a.bauthor").text().trim()||void 0,genres:b,status:"Ongoing"===x?i.NovelStatus.Ongoing:"Completed"===x?i.NovelStatus.Completed:i.NovelStatus.Unknown,chapters:[]},(C=l("#bid").attr("value"))?(T=k,[4,this.parseChapterList(C)]):[3,7];case 6:T.chapters=e.sent(),e.label=7;case 7:return[2,k]}}))}))},o.prototype.parseChapterList=function(r){return t(this,void 0,void 0,(function(){var t,n,a,i;return e(this,(function(e){switch(e.label){case 0:return t=String(r),n="".concat(this.site,"novel/clist/"),[4,fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"bid=".concat(t)})];case 1:if(!(a=e.sent()).ok)throw new Error("Failed to fetch chapters for bid=".concat(t));return[4,a.json()];case 2:if(200!==(i=e.sent()).rs||!Array.isArray(i.data))throw new Error("Invalid response format from chapter list");return[2,i.data.map((function(e){return{name:e.title,path:"0"===e.ctype?"read/".concat(t,"/p").concat(e.ordernum,".html"):"",releaseTime:void 0}}))]}}))}))},o.prototype.parseChapter=function(a){return t(this,void 0,void 0,(function(){var t,i,o,c,l,u,p,f,d,v,m;return e(this,(function(e){switch(e.label){case 0:if(!(t=s(a,this.site)))throw new Error("Invalid chapter URL");return[4,(0,n.fetchApi)(t)];case 1:if(!(i=e.sent()).ok)throw new Error("Failed to fetch chapter at ".concat(t));return[4,i.text()];case 2:return((o=e.sent()).includes("Ê≠£Âú®ÈÄ≤Ë°åÂÆâÂÖ®È©óË≠â")||o.includes("challenge"))&&(c=o.match(/let token\s*=\s*"([^"]+)"/))?(l=t+"?challenge="+encodeURIComponent(c[1]),[4,(0,n.fetchApi)(l)]):[3,5];case 3:if(!(i=e.sent()).ok)throw new Error("Failed after challenge redirect: ".concat(l));return[4,i.text()];case 4:o=e.sent(),e.label=5;case 5:return u=(0,r.load)(o),p=u("article h3"),f=p.text().trim(),(d=u("article section")).length?(d.find('script, style, ins, iframe, [class*="abg"], [class*="ads"], [id*="ads"], [class*="google"], [id*="google"], [class*="recommend"], div[align="center"], p:contains("Êé®Ëñ¶Êú¨Êõ∏"), a[href*="javascript:"]').remove(),d.find("p").each((function(t,e){var r=u(e);r.text().trim()||r.remove()})),d.contents().filter((function(){return"comment"===this.type})).remove(),(v=d.html()||"")?(m="",(v="<h1>"+f+"</h1>üêº<br>"+v).trim()?[4,h(v,"ru")]:[3,7]):[2,"Error: Chapter content was empty"]):[2,"Error: Could not find chapter content at ".concat(t)];case 6:return m=e.sent(),[3,8];case 7:m="",e.label=8;case 8:return[2,m.trim()]}}))}))},o.prototype.searchNovels=function(i,o){return t(this,void 0,void 0,(function(){var t,o,c,l,u,h,p=this;return e(this,(function(e){switch(e.label){case 0:t="".concat(this.site,"bsearch?q=").concat(encodeURIComponent(i)),o="",e.label=1;case 1:return e.trys.push([1,4,,5]),[4,(0,n.fetchApi)(t)];case 2:if(!(c=e.sent()).ok)throw new Error("Failed to fetch search results: HTTP ".concat(c.status));return[4,c.text()];case 3:return o=e.sent(),[3,5];case 4:if((l=e.sent())instanceof Error)throw new Error("Failed to fetch search results: ".concat(l.message));throw l;case 5:return u=(0,r.load)(o),h=[],u("ul.u-list li.burl").each((function(t,e){var r,n,i=u(e),o=null===(r=i.attr("data-url"))||void 0===r?void 0:r.trim(),c=i.find("h3.bname a").text().trim(),l=null===(n=i.find(".l-img img").attr("src"))||void 0===n?void 0:n.trim();o&&c&&h.push({name:c,path:o,cover:s(l,p.site)||a.defaultCover})})),[2,h]}}))}))},o}();exports.default=new o;var s=function(t,e){if(t)try{if(t.startsWith("//"))return new URL(e).protocol+t;if(t.startsWith("http://")||t.startsWith("https://"))return t;var r=e.endsWith("/")?e.slice(0,-1):e,n=t.startsWith("/")?t.slice(1):t;return new URL(n,r).href}catch(t){return}};function c(t,e){return void 0===e&&(e=1e3),function(t){return t.replace(/<\/p\s*>/gi,"\n").replace(/<p[^>]*>/gi,"\n").replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]+>/g,"").replace(/\u3000/g," ").replace(/&nbsp;/g," ").trim().split(/\n+/).map((function(t){return t.trim()})).filter(Boolean)}(t).flatMap((function(t){return function(t,e){return void 0===e&&(e=1e3),t.length<=e?[t]:t.split(/([„ÄÇ.!?ÔºÅÔºü])/g).reduce((function(t,r){return!t.length||(t[t.length-1]+r).length>e?t.push(r):t[t.length-1]+=r,t}),[]).flatMap((function(t){if(t.length<=e)return[t];for(var r=[],n="",a=0,i=t.split(/\s+/);a<i.length;a++){var o=i[a];(n+" "+o).trim().length>e?(n&&r.push(n.trim()),n=o):n=(n+" "+o).trim()}return n&&r.push(n.trim()),r}))}(t,e)}))}function l(r,n){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return[4,fetch("https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-CN&tl=".concat(n,"&dt=t&q=").concat(encodeURIComponent(r)))];case 1:if(!(t=e.sent()).ok)throw new Error("Translate failed ".concat(t.status," ").concat(r));return[4,t.json()];case 2:return[2,e.sent()[0].map((function(t){return t[0]})).join("")]}}))}))}function u(r,n){return t(this,void 0,void 0,(function(){var t,a,i,o,s,u,h;return e(this,(function(e){switch(e.label){case 0:if(r.length<2)return[2,r];t=c(r,1e3),a=[],i=0,o=t,e.label=1;case 1:return i<o.length?(s=o[i],h=(u=a).push,[4,l(s,n)]):[3,5];case 2:return h.apply(u,[e.sent()]),[4,new Promise((function(t){return setTimeout(t,500)}))];case 3:e.sent(),e.label=4;case 4:return i++,[3,1];case 5:return[2,a.map((function(t){return"<p>".concat(t,"</p>")})).join("\n")]}}))}))}function h(r,n){return t(this,void 0,void 0,(function(){var t,a,i,o,s,c,l,u,h,f,d,v;return e(this,(function(e){switch(e.label){case 0:for(r=r.replace(/<(\w+)[^>]*>/g,"<$1>"),t=[],a=new RegExp("(".concat(["</p>","</h1>","</h2>","</h3>","</h4>","</li>","<br>"].join("|"),")"),"gi"),i=r.split(a).filter(Boolean),f=0;f<i.length;f+=2)o=(i[f]||"").replace(/<[^>]+>/g,"").trim(),s=(i[f+1]||"").toLowerCase(),(o||s)&&("</li>"===s?o&&t.push({tag:"LI",text:o,parentTag:"UL"}):s.startsWith("</h")?(o&&t.push({tag:s.replace(/[<>]/g,"").toUpperCase(),text:o}),t.push({tag:"BR",text:""})):o&&t.push({tag:"P",text:o}));return c=" üòÄ ",[4,p(t.map((function(t){return"BR"===t.tag?"":t.text})).join(c),n)];case 1:for(l=(l=e.sent()).replace(/^\[\[\"/,"").replace(/\"\],\s*\[\".*\"\]\]$/,""),u=l.split(c),h="",f=0;f<t.length;f++)d=t[f],v=u[f]||"",/^–ì–ª–∞–≤–∞\s+\d+/i.test(v)?h+="<h1>".concat(v,"</h1>"):"BR"===d.tag?h+="<br>":"LI"===d.tag?h+="<ul><li>".concat(v,"</li></ul>"):d.tag.startsWith("H")?h+="<".concat(d.tag,">").concat(v,"</").concat(d.tag,">"):h+="<p>".concat(v,"</p>");return[2,h]}}))}))}function p(r,n){return t(this,void 0,void 0,(function(){var t,a,i,o,s,c;return e(this,(function(e){switch(e.label){case 0:t="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36",a=JSON.stringify([[[r],"auto",n],"wt_lib"]),i="",e.label=1;case 1:return e.trys.push([1,6,,7]),[4,fetch("https://translate-pa.googleapis.com/v1/translateHtml",{method:"POST",headers:{"User-Agent":t,"X-Goog-API-Key":"AIzaSyATBXajvzQLTDHEQbcpq0Ihe0vWDHmO520","Content-Type":"application/json+protobuf"},body:a})];case 2:return(o=e.sent()).ok?[3,4]:(i="HTTP error ".concat(o.status,": ").concat(o.statusText),[4,o.text()]);case 3:return s=e.sent(),[2,i+="\nError body:"+s];case 4:return[4,o.text()];case 5:return i=e.sent(),[3,7];case 6:return c=e.sent(),i="Fetch failed:"+c,[3,7];case 7:return[2,i]}}))}))}
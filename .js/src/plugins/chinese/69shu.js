var t=this&&this.__assign||function(){return t=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},t.apply(this,arguments)},e=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{l(r.next(t))}catch(t){i(t)}}function s(t){try{l(r.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}l((r=r.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeChunksFromHTML=l,exports.translate=u;var r=require("cheerio"),a=require("@libs/fetch"),i=require("@libs/filterInputs"),o=require("@libs/novelStatus");function s(t,e){if(void 0===e&&(e=1e3),t.length<=e)return[t];var n=t.split(/([。.!?！？])/g).reduce((function(t,n){return 0===t.length?[n]:((t[t.length-1]+n).length>e?t.push(n):t[t.length-1]+=n,t)}),[]);return n=n.flatMap((function(t){if(t.length<=e)return[t];for(var n=[],r="",a=0,i=t.split(/\s+/);a<i.length;a++){var o=i[a];(r+" "+o).trim().length>e?(r&&n.push(r.trim()),r=o):r=(r+" "+o).trim()}return r&&n.push(r.trim()),n}))}function l(t,e){void 0===e&&(e=1e3);for(var n=function(t){return t.replace(/<\/p\s*>/gi,"\n").replace(/<p[^>]*>/gi,"\n").replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]+>/g,"").replace(/\u3000/g," ").replace(/&nbsp;/g," ").trim().split(/\n+/).map((function(t){return t.trim()})).filter((function(t){return t.length>0}))}(t),r=[],a=0,i=n;a<i.length;a++){var o=s(i[a],e);r.push.apply(r,o)}return r}function c(t,r){return e(this,void 0,void 0,(function(){var e,a;return n(this,(function(n){switch(n.label){case 0:return e="https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-CN&tl=".concat(r,"&dt=t&q=").concat(encodeURIComponent(t)),[4,fetch(e)];case 1:if(!(a=n.sent()).ok)throw new Error("Translate request failed with status ".concat(a.status," ").concat(t));return[4,a.json()];case 2:return[2,n.sent()[0].map((function(t){return t[0]})).join("")]}}))}))}function u(t,r){return e(this,void 0,void 0,(function(){var e,a,i,o,s;return n(this,(function(n){switch(n.label){case 0:if(t.length<2)return[2,t];e=l(t,1e3),a=[],i=0,o=e,n.label=1;case 1:return i<o.length?[4,c(o[i],r)]:[3,5];case 2:return s=n.sent(),a.push(s),[4,new Promise((function(t){return setTimeout(t,500)}))];case 3:n.sent(),n.label=4;case 4:return i++,[3,1];case 5:return[2,a.map((function(t){return"<p>".concat(t,"</p>")})).join("\n")]}}))}))}var h=function(){function s(){this.fetchOptions={headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:137.0) Gecko/20100101 Firefox/137.0",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Language":"en-US,us;q=0.5",Referer:"https://www.69shu.xyz/",DNT:"1","Upgrade-Insecure-Requests":"1"}},this.id="69shu",this.name="69书吧",this.icon="src/cn/69shu/icon.png",this.site="https://www.69shu.xyz",this.version="1.2.2",this.filters={rank:{label:"排行榜",value:"allvisit",options:[{label:"总排行榜",value:"allvisit"},{label:"月排行榜",value:"monthvisit"},{label:"周排行榜",value:"weekvisit"},{label:"日排行榜",value:"dayvisit"},{label:"收藏榜",value:"goodnum"},{label:"字数榜",value:"words"},{label:"推荐榜",value:"allvote"},{label:"新书榜",value:"postdate"},{label:"更新榜",value:"lastupdate"}],type:i.FilterTypes.Picker},sort:{label:"分类",value:"none",options:[{label:"无",value:"none"},{label:"全部",value:"all"},{label:"玄幻",value:"xuanhuan"},{label:"仙侠",value:"xianxia"},{label:"都市",value:"dushi"},{label:"历史",value:"lishi"},{label:"游戏",value:"youxi"},{label:"科幻",value:"kehuan"},{label:"灵异",value:"kongbu"},{label:"言情",value:"nvsheng"},{label:"其它",value:"qita"}],type:i.FilterTypes.Picker}}}return s.prototype.popularNovels=function(t,i){return e(this,arguments,void 0,(function(t,e){var i,o,s,l,c=this,u=e.showLatestNovels,h=e.filters;return n(this,(function(e){switch(e.label){case 0:return i=u?"".concat(this.site,"/rank/lastupdate/").concat(t,".html"):"none"===h.sort.value?"".concat(this.site,"/rank/").concat(h.rank.value,"/").concat(t,".html"):"".concat(this.site,"/sort/").concat(h.sort.value,"/").concat(t,".html"),[4,(0,a.fetchText)(i,this.fetchOptions)];case 1:if(""===(o=e.sent()))throw Error("无法获取小说列表，请检查网络");return s=(0,r.load)(o),l=[],s("div.book-coverlist").each((function(t,e){var n=s(e).find("a.cover").attr("href"),r=s(e).find("h4.name").text().trim(),a=s(e).find("a.cover > img").attr("src");if(n){var i={name:r,cover:a,path:n.replace(c.site,"")};l.push(i)}})),[2,l]}}))}))},s.prototype.parseNovel=function(t){return e(this,void 0,void 0,(function(){var e,i,s,l,c,h,p,f,v,d,b,m,g,w=this;return n(this,(function(x){switch(x.label){case 0:return e=this.site+t,[4,(0,a.fetchText)(e,this.fetchOptions)];case 1:if(""===(i=x.sent()))throw Error("无法获取小说内容，请检查网络");return s=(0,r.load)(i),(l={path:t,chapters:[],name:s("h1").text().trim()}).cover=s("div.cover > img").attr("src"),c=l,[4,u(s("#bookIntro").text().trim(),"ru")];case 2:if(c.summary=x.sent(),h=s("div.caption-bookinfo > p"),l.author=h.find("a").attr("title"),l.artist=void 0,l.status=h.text().includes("连载")?o.NovelStatus.Ongoing:o.NovelStatus.Completed,l.genres="",p=[],!(f=s("dd.all > a").attr("href")))return[3,6];v=new URL(f,this.site).toString(),d=!0,b=function(){var t,e,i,o,s;return n(this,(function(n){switch(n.label){case 0:return[4,(0,a.fetchText)(v,m.fetchOptions)];case 1:if(t=n.sent(),(e=(0,r.load)(t))("dl.panel-chapterlist dd").each((function(t,n){var r=e(n).find("a").attr("href"),a=e(n).find("a").text().trim();if(r){var i=r.startsWith("http")?r.replace(w.site,""):r;p.some((function(t){return t.path===i}))||p.push({name:a,path:i})}})),i=e("div.listpage a.onclick").filter((function(t,n){return e(n).text().includes("下一页")})),(o=i.attr("href"))&&"javascript:void(0);"!==o)try{(s=new URL(o,m.site).toString())===v?d=!1:v=s}catch(t){console.warn("Invalid next page link found: ".concat(o)),d=!1}else d=!1;return[2]}}))},m=this,x.label=3;case 3:return d?[5,b()]:[3,5];case 4:return x.sent(),[3,3];case 5:return[3,7];case 6:s("div.panel.hidden-xs > dl.panel-chapterlist:nth-child(2) > dd").each((function(t,e){var n=s(e).find("a").attr("href"),r=s(e).find("a").text().trim();if(n){var a=n.startsWith("http")?n.replace(w.site,""):n;p.push({name:r,path:a})}})),x.label=7;case 7:return g=p.filter((function(t,e,n){return e===n.findIndex((function(e){return e.path===t.path}))})),l.chapters=g,[2,l]}}))}))},s.prototype.parseChapter=function(t){return e(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:return e=new URL(t,this.site).toString(),[4,(0,a.fetchText)(e,this.fetchOptions)];case 1:return i=n.sent(),o=(0,r.load)(i),[4,u(o("#chaptercontent p").map((function(t,e){return o(e).text()})).get().map((function(t){return t.trim()})).filter((function(t){return""!==t&&!t.includes("69书吧")})).map((function(t){return"<p>".concat(t,"</p>")})).join("\n"),"ru")];case 2:return[2,n.sent()]}}))}))},s.prototype.searchNovels=function(i,o){return e(this,void 0,void 0,(function(){var e,s,l,c,u,h,p=this;return n(this,(function(n){switch(n.label){case 0:return o>1?[2,[]]:(e="".concat(this.site,"/search"),(s=new FormData).append("searchkey",i),l=t(t({},this.fetchOptions),{method:"post",body:s,headers:t({},this.fetchOptions.headers)}),[4,(0,a.fetchText)(e,l)]);case 1:if(""===(c=n.sent()))throw Error("无法获取搜索结果，请检查网络");return u=(0,r.load)(c),h=[],u("div.book-coverlist").each((function(t,e){var n=u(e).find("a.cover").attr("href"),r=u(e).find("h4.name").text().trim(),a=u(e).find("a.cover > img").attr("src");if(n){var i={name:r,cover:a,path:n.replace(p.site,"")};h.push(i)}})),[2,h]}}))}))},s}();exports.default=new h;
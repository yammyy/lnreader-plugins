var t=this&&this.__assign||function(){return t=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},t.apply(this,arguments)},e=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}c((r=r.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeChunksFromHTML=c,exports.translate=u,exports.translateAutoHotkeyStyle=p;var r=require("cheerio"),a=require("@libs/fetch"),i=require("@libs/filterInputs"),o=require("@libs/novelStatus"),s=function(){function s(){this.fetchOptions={headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:137.0) Gecko/20100101 Firefox/137.0",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Language":"en-US,us;q=0.5",Referer:"https://www.69shu.xyz/",DNT:"1","Upgrade-Insecure-Requests":"1"}},this.id="69shu",this.name="69‰π¶Âêß",this.icon="src/cn/69shu/icon.png",this.site="https://www.69shu.xyz",this.version="5.2.2",this.filters={rank:{label:"ÊéíË°åÊ¶ú",value:"allvisit",options:[{label:"ÊÄªÊéíË°åÊ¶ú",value:"allvisit"},{label:"ÊúàÊéíË°åÊ¶ú",value:"monthvisit"},{label:"Âë®ÊéíË°åÊ¶ú",value:"weekvisit"},{label:"Êó•ÊéíË°åÊ¶ú",value:"dayvisit"},{label:"Êî∂ËóèÊ¶ú",value:"goodnum"},{label:"Â≠óÊï∞Ê¶ú",value:"words"},{label:"Êé®ËçêÊ¶ú",value:"allvote"},{label:"Êñ∞‰π¶Ê¶ú",value:"postdate"},{label:"Êõ¥Êñ∞Ê¶ú",value:"lastupdate"}],type:i.FilterTypes.Picker},sort:{label:"ÂàÜÁ±ª",value:"none",options:[{label:"Êó†",value:"none"},{label:"ÂÖ®ÈÉ®",value:"all"},{label:"ÁéÑÂπª",value:"xuanhuan"},{label:"‰ªô‰æ†",value:"xianxia"},{label:"ÈÉΩÂ∏Ç",value:"dushi"},{label:"ÂéÜÂè≤",value:"lishi"},{label:"Ê∏∏Êàè",value:"youxi"},{label:"ÁßëÂπª",value:"kehuan"},{label:"ÁÅµÂºÇ",value:"kongbu"},{label:"Ë®ÄÊÉÖ",value:"nvsheng"},{label:"ÂÖ∂ÂÆÉ",value:"qita"}],type:i.FilterTypes.Picker}}}return s.prototype.popularNovels=function(t,i){return e(this,arguments,void 0,(function(t,e){var i,o,s,c,l=this,u=e.showLatestNovels,h=e.filters;return n(this,(function(e){switch(e.label){case 0:return i=u?"".concat(this.site,"/rank/lastupdate/").concat(t,".html"):"none"===h.sort.value?"".concat(this.site,"/rank/").concat(h.rank.value,"/").concat(t,".html"):"".concat(this.site,"/sort/").concat(h.sort.value,"/").concat(t,".html"),[4,(0,a.fetchText)(i,this.fetchOptions)];case 1:if(""===(o=e.sent()))throw Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–æ–≤–∏–Ω–æ–∫, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å.");return s=(0,r.load)(o),c=[],s("div.book-coverlist").each((function(t,e){var n=s(e).find("a.cover").attr("href"),r=s(e).find("h4.name").text().trim(),a=s(e).find("a.cover > img").attr("src");if(n){var i={name:r,cover:a,path:n.replace(l.site,"")};c.push(i)}})),[2,c]}}))}))},s.prototype.parseNovel=function(t){return e(this,void 0,void 0,(function(){var e,i,s,c,l,h,p,f,v,d,b,g,m,x=this;return n(this,(function(w){switch(w.label){case 0:return e=this.site+t,[4,(0,a.fetchText)(e,this.fetchOptions)];case 1:if(""===(i=w.sent()))throw Error("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å.");return s=(0,r.load)(i),(c={path:t,chapters:[],name:s("h1").text().trim()}).cover=s("div.cover > img").attr("src"),l=c,[4,u(s("#bookIntro").text().trim(),"ru")];case 2:if(l.summary=w.sent(),h=s("div.caption-bookinfo > p"),c.author=h.find("a").attr("title"),c.artist=void 0,c.status=h.text().includes("ËøûËΩΩ")?o.NovelStatus.Ongoing:o.NovelStatus.Completed,c.genres="",p=[],!(f=s("dd.all > a").attr("href")))return[3,6];v=new URL(f,this.site).toString(),d=!0,b=function(){var t,e,i,o,s;return n(this,(function(n){switch(n.label){case 0:return[4,(0,a.fetchText)(v,g.fetchOptions)];case 1:if(t=n.sent(),(e=(0,r.load)(t))("dl.panel-chapterlist dd").each((function(t,n){var r=e(n).find("a").attr("href"),a=e(n).find("a").text().trim();if(r){var i=r.startsWith("http")?r.replace(x.site,""):r;p.some((function(t){return t.path===i}))||p.push({name:a,path:i})}})),i=e("div.listpage a.onclick").filter((function(t,n){return e(n).text().includes("‰∏ã‰∏ÄÈ°µ")})),(o=i.attr("href"))&&"javascript:void(0);"!==o)try{(s=new URL(o,g.site).toString())===v?d=!1:v=s}catch(t){console.warn("Invalid next page link found: ".concat(o)),d=!1}else d=!1;return[2]}}))},g=this,w.label=3;case 3:return d?[5,b()]:[3,5];case 4:return w.sent(),[3,3];case 5:return[3,7];case 6:s("div.panel.hidden-xs > dl.panel-chapterlist:nth-child(2) > dd").each((function(t,e){var n=s(e).find("a").attr("href"),r=s(e).find("a").text().trim();if(n){var a=n.startsWith("http")?n.replace(x.site,""):n;p.push({name:r,path:a})}})),w.label=7;case 7:return m=p.filter((function(t,e,n){return e===n.findIndex((function(e){return e.path===t.path}))})),c.chapters=m,[2,c]}}))}))},s.prototype.parseChapter=function(t){return e(this,void 0,void 0,(function(){var e,i,o,s,c,l;return n(this,(function(n){switch(n.label){case 0:return e=new URL(t,this.site).toString(),[4,(0,a.fetchText)(e,this.fetchOptions)];case 1:return i=n.sent(),o=(0,r.load)(i),s=o("h1").text().trim(),c=o("#chaptercontent p").map((function(t,e){var n=o(e).text().trim();return!n||n.includes("69‰π¶Âêß")?"":/^–ì–ª–∞–≤–∞\s+\d+/i.test(n)?"<h1>".concat(n,"</h1>"):"<p>".concat(n,"</p>")})).get().join(""),c="<h1>".concat(s,"</h1>")+"üêº<br>"+c,l="",c.trim()?[4,h(c,"ru")]:[3,3];case 2:return l=n.sent(),[3,4];case 3:l="",n.label=4;case 4:return[2,l.trim()]}}))}))},s.prototype.searchNovels=function(i,o){return e(this,void 0,void 0,(function(){var e,s,c,l,u,h,p=this;return n(this,(function(n){switch(n.label){case 0:return o>1?[2,[]]:(e="".concat(this.site,"/search"),(s=new FormData).append("searchkey",i),c=t(t({},this.fetchOptions),{method:"post",body:s,headers:t({},this.fetchOptions.headers)}),[4,(0,a.fetchText)(e,c)]);case 1:if(""===(l=n.sent()))throw Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å.");return u=(0,r.load)(l),h=[],u("div.book-coverlist").each((function(t,e){var n=u(e).find("a.cover").attr("href"),r=u(e).find("h4.name").text().trim(),a=u(e).find("a.cover > img").attr("src");if(n){var i={name:r,cover:a,path:n.replace(p.site,"")};h.push(i)}})),[2,h]}}))}))},s}();exports.default=new s;function c(t,e){return void 0===e&&(e=1e3),function(t){return t.replace(/<\/p\s*>/gi,"\n").replace(/<p[^>]*>/gi,"\n").replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]+>/g,"").replace(/\u3000/g," ").replace(/&nbsp;/g," ").trim().split(/\n+/).map((function(t){return t.trim()})).filter(Boolean)}(t).flatMap((function(t){return function(t,e){return void 0===e&&(e=1e3),t.length<=e?[t]:t.split(/([„ÄÇ.!?ÔºÅÔºü])/g).reduce((function(t,n){return!t.length||(t[t.length-1]+n).length>e?t.push(n):t[t.length-1]+=n,t}),[]).flatMap((function(t){if(t.length<=e)return[t];for(var n=[],r="",a=0,i=t.split(/\s+/);a<i.length;a++){var o=i[a];(r+" "+o).trim().length>e?(r&&n.push(r.trim()),r=o):r=(r+" "+o).trim()}return r&&n.push(r.trim()),n}))}(t,e)}))}function l(t,r){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return[4,fetch("https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-CN&tl=".concat(r,"&dt=t&q=").concat(encodeURIComponent(t)))];case 1:if(!(e=n.sent()).ok)throw new Error("Translate failed ".concat(e.status," ").concat(t));return[4,e.json()];case 2:return[2,n.sent()[0].map((function(t){return t[0]})).join("")]}}))}))}function u(t,r){return e(this,void 0,void 0,(function(){var e,a,i,o,s,u,h;return n(this,(function(n){switch(n.label){case 0:if(t.length<2)return[2,t];e=c(t,1e3),a=[],i=0,o=e,n.label=1;case 1:return i<o.length?(s=o[i],h=(u=a).push,[4,l(s,r)]):[3,5];case 2:return h.apply(u,[n.sent()]),[4,new Promise((function(t){return setTimeout(t,500)}))];case 3:n.sent(),n.label=4;case 4:return i++,[3,1];case 5:return[2,a.map((function(t){return"<p>".concat(t,"</p>")})).join("\n")]}}))}))}function h(t,r){return e(this,void 0,void 0,(function(){var e,a,i,o,s,c,l,u,h,f,v,d;return n(this,(function(n){switch(n.label){case 0:for(t=t.replace(/<(\w+)[^>]*>/g,"<$1>"),e=[],a=new RegExp("(".concat(["</p>","</h1>","</h2>","</h3>","</h4>","</li>","<br>"].join("|"),")"),"gi"),i=t.split(a).filter(Boolean),f=0;f<i.length;f+=2)o=(i[f]||"").replace(/<[^>]+>/g,"").trim(),s=(i[f+1]||"").toLowerCase(),(o||s)&&("</li>"===s?o&&e.push({tag:"LI",text:o,parentTag:"UL"}):s.startsWith("</h")?(o&&e.push({tag:s.replace(/[<>]/g,"").toUpperCase(),text:o}),e.push({tag:"BR",text:""})):o&&e.push({tag:"P",text:o}));return c=" üòÄ ",[4,p(e.map((function(t){return"BR"===t.tag?"":t.text})).join(c),r)];case 1:for(l=(l=n.sent()).replace(/^\[\[\"/,"").replace(/\"\],\s*\[\".*\"\]\]$/,""),u=l.split(c),h="",f=0;f<e.length;f++)v=e[f],d=u[f]||"",/^–ì–ª–∞–≤–∞\s+\d+/i.test(d)?h+="<h1>".concat(d,"</h1>"):"BR"===v.tag?h+="<br>":"LI"===v.tag?h+="<ul><li>".concat(d,"</li></ul>"):v.tag.startsWith("H")?h+="<".concat(v.tag,">").concat(d,"</").concat(v.tag,">"):h+="<p>".concat(d,"</p>");return[2,h]}}))}))}function p(t,r){return e(this,void 0,void 0,(function(){var e,a,i,o,s,c;return n(this,(function(n){switch(n.label){case 0:e="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36",a=JSON.stringify([[[t],"auto",r],"wt_lib"]),i="",n.label=1;case 1:return n.trys.push([1,6,,7]),[4,fetch("https://translate-pa.googleapis.com/v1/translateHtml",{method:"POST",headers:{"User-Agent":e,"X-Goog-API-Key":"AIzaSyATBXajvzQLTDHEQbcpq0Ihe0vWDHmO520","Content-Type":"application/json+protobuf"},body:a})];case 2:return(o=n.sent()).ok?[3,4]:(i="HTTP error ".concat(o.status,": ").concat(o.statusText),[4,o.text()]);case 3:return s=n.sent(),[2,i+="\nError body:"+s];case 4:return[4,o.text()];case 5:return i=n.sent(),[3,7];case 6:return c=n.sent(),i="Fetch failed:"+c,[3,7];case 7:return[2,i]}}))}))}